# -*- coding:utf-8 -*-

import scipy.signal as signal
import math

def edit_theta(theta0, ranges):
    r = 0.5
    roslen = 0.45
    theta = round(-theta0 / math.pi * 180)
    # ranges = signal.medfilt(ranges, 5)  # 中值滤波，去除噪声
    ranges = [3.5 if i == 0 else i for i in ranges]
    alpha = int((0.45 / r) / math.pi * 180) + 1  # 若要机器人通过，最少需要alpha个连续的角度没有障碍（角度之间间隔1°）
    if alpha//2==0:
        alpha += 1  # 为了使0°无障碍时的计算没有偏差，alpha取奇数

    # 从左往右扫描
    ans1 = -10  # 记录从左往右扫描的结果，-1表示无解
    now_angle = int((180 - theta - alpha//2 + 360) % 360) # 初始值为中间，从中间往左
    count = 0  # 记录 已经经过的 连续的 没有障碍的 角度 个数
    for ii in range(180+alpha//2):
        if ranges[now_angle] < r:
            count = 0
        else:
            count += 1
        if count >= alpha:
            ans1 = (now_angle - alpha // 2  + 360) % 360
            break
        now_angle = (now_angle+1) % 360


    # 从右往左扫描
    ans2 = -10  # 记录从右往左扫描的结果，-1表示无解
    now_angle = int((180 - theta + alpha // 2 + 360) % 360)  # 初始值为中间，从中间往左
    count = 0  # 记录 已经经过的 连续的 没有障碍的 角度 个数
    for ii in range(180 + alpha // 2):
    # while count < alpha and now_angle >= 90 - alpha // 2:
        if ranges[now_angle] < r:
            count = 0
        else:
            count += 1
        if count >= alpha:
            ans2 = (now_angle + alpha // 2) % 360
            break
        now_angle = (now_angle-1+360) % 360

    flag1 = 1
    while flag1 == 1:
        flag1 = 0
        for num in range(0, 360):
            num1 = (ans1 - 180 + num) % 360
            if ranges[num1] < r:
                s1 = num1 / 180.0 * math.pi
                s2 = (int(ans1 - 180 + 360) % 360 / 180.0) * math.pi
                flag2 = ranges[num1] * (math.sin(s1) * math.cos(s2) - math.sin(s2) * math.cos(s1))
                flag3 = ranges[num1] * (math.sin(s1) * math.sin(s2) + math.cos(s2) * math.cos(s1))
                #print(num)
                #print(flag2)
                #print(flag3)
                if abs(flag2) < roslen / 2:
                    if flag3 < roslen / 2:
                        flag1 = 1
                        break
        if flag1 == 1:
            if ans1 < ans2 :
                ans1 = (ans1 - 1) % 360
            else:
                ans1 = (ans1 + 1) % 360

    flag1 = 1
    while flag1 == 1:
        flag1 = 0
        for num in range(0, 360):
            num1 = (ans2 - 180 + num) % 360
            if ranges[num1] < r:
                s1 = num1 / 180.0 * math.pi
                s2 = (int(ans2 - 180 + 360) % 360 / 180.0) * math.pi
                flag2 = ranges[num1] * (math.sin(s1) * math.cos(s2) - math.sin(s2) * math.cos(s1))
                flag3 = ranges[num1] * (math.sin(s1) * math.sin(s2) + math.cos(s2) * math.cos(s1))
                # print(num)
                # print(flag2)
                # print(flag3)
                if abs(flag2) < roslen / 2:
                    if flag3 < roslen / 2:
                        flag1 = 1
                        break
        if flag1 == 1:
            if ans1 < ans2:
                ans2 = (ans2 + 1) % 360
            else:
                ans2 = (ans2 - 1) % 360

    #ans1 = (ans1-180.0) / 180.0 * math.pi
    #ans2 = (ans2-180.0) / 180.0 * math.pi
    #if abs(ans1-theta0) < abs(ans2-theta0):
        #return ans1
    #else:
        #return ans2
    return [ans1,ans2]

if __name__=="__main__":
    # ranges = [3.572999954223633, 3.630000114440918, 3.509999990463257, 0.0, 3.7309999465942383, 3.696000099182129, 3.7239999771118164, 3.690000057220459, 0.0, 3.8499999046325684, 3.763000011444092, 3.828000068664551, 3.6600000858306885, 3.9230000972747803, 3.86899995803833, 1.7170000076293945, 3.86299991607666, 3.9760000705718994, 3.937000036239624, 4.031000137329102, 1.2519999742507935, 0.0, 0.9490000009536743, 0.9620000123977661, 0.9760000109672546, 0.9890000224113464, 1.00600004196167, 3.5999999046325684, 3.5290000438690186, 3.4010000228881836, 3.3450000286102295, 3.2239999771118164, 0.9629999995231628, 1.0160000324249268, 1.0049999952316284, 1.0049999952316284, 1.0140000581741333, 1.968999981880188, 1.652999997138977, 1.656999945640564, 1.6579999923706055, 1.6260000467300415, 2.502000093460083, 2.4590001106262207, 2.4079999923706055, 2.377000093460083, 2.3420000076293945, 2.312000036239624, 2.25, 2.249000072479248, 2.2249999046325684, 2.188999891281128, 2.1679999828338623, 0.0, 2.1110000610351562, 2.0929999351501465, 2.063999891281128, 2.053999900817871, 2.0280001163482666, 1.934000015258789, 1.1130000352859497, 1.9160000085830688, 1.9500000476837158, 1.9299999475479126, 1.9359999895095825, 1.8990000486373901, 1.9210000038146973, 1.8890000581741333, 1.8580000400543213, 1.871000051498413, 1.8270000219345093, 1.8029999732971191, 0.0, 1.8140000104904175, 1.809000015258789, 1.7990000247955322, 1.7799999713897705, 1.7710000276565552, 1.7669999599456787, 1.7699999809265137, 1.7519999742507935, 1.7519999742507935, 1.7430000305175781, 1.7359999418258667, 1.746999979019165, 1.7419999837875366, 1.7330000400543213, 1.7350000143051147, 1.7259999513626099, 1.753000020980835, 1.7400000095367432, 1.7259999513626099, 1.656999945640564, 1.7380000352859497, 1.7400000095367432, 1.7400000095367432, 1.7489999532699585, 1.6390000581741333, 1.7649999856948853, 1.7719999551773071, 1.7799999713897705, 0.9480000138282776, 0.9480000138282776, 1.7769999504089355, 1.7869999408721924, 1.8020000457763672, 1.812999963760376, 1.847000002861023, 1.8370000123977661, 1.8600000143051147, 1.8600000143051147, 1.8860000371932983, 1.8980000019073486, 1.9179999828338623, 1.934999942779541, 1.9709999561309814, 1.9739999771118164, 1.9809999465942383, 1.9980000257492065, 2.009999990463257, 2.0369999408721924, 2.056999921798706, 2.0850000381469727, 2.1019999980926514, 2.128999948501587, 2.1510000228881836, 2.1600000858306885, 0.9829999804496765, 0.0, 2.255000114440918, 2.296999931335449, 2.2980000972747803, 2.368000030517578, 2.3320000171661377, 2.437999963760376, 2.489000082015991, 2.5260000228881836, 2.5869998931884766, 2.7019999027252197, 2.73799991607666, 1.621999979019165, 0.0, 2.8889999389648438, 2.9749999046325684, 0.7329999804496765, 0.796999990940094, 0.0, 3.2899999618530273, 1.8179999589920044, 3.190000057220459, 3.1760001182556152, 0.0, 0.0, 0.0, 1.2259999513626099, 0.0, 3.115999937057495, 0.0, 0.0, 0.0, 0.0, 3.1050000190734863, 3.0220000743865967, 3.0179998874664307, 2.9739999771118164, 3.0190000534057617, 2.9489998817443848, 2.924999952316284, 2.884999990463257, 2.8299999237060547, 2.8369998931884766, 2.8389999866485596, 2.8440001010894775, 2.8499999046325684, 2.7739999294281006, 2.7760000228881836, 2.822999954223633, 2.818000078201294, 0.257999986410141, 0.257999986410141, 0.2590000033378601, 0.25699999928474426, 0.25600001215934753, 0.2549999952316284, 0.0, 0.257999986410141, 0.25999999046325684, 0.2619999945163727, 0.289000004529953, 0.0, 0.0, 2.561000108718872, 2.875, 2.9049999713897705, 2.9070000648498535, 2.947000026702881, 2.9230000972747803, 2.9570000171661377, 2.99399995803833, 2.9579999446868896, 2.996999979019165, 2.99399995803833, 3.0260000228881836, 3.0759999752044678, 3.1080000400543213, 3.11899995803833, 3.1470000743865967, 3.1619999408721924, 0.0, 3.109999895095825, 1.8980000019073486, 3.3420000076293945, 3.3010001182556152, 3.4019999504089355, 3.3889999389648438, 3.385999917984009, 3.2760000228881836, 3.2230000495910645, 3.2730000019073486, 3.130000114440918, 2.321000099182129, 3.0929999351501465, 2.993000030517578, 2.0209999084472656, 2.8970000743865967, 2.8970000743865967, 2.8350000381469727, 2.802000045776367, 2.7739999294281006, 2.6440000534057617, 2.622999906539917, 2.5799999237060547, 2.5769999027252197, 2.5480000972747803, 2.500999927520752, 2.486999988555908, 2.4609999656677246, 2.430000066757202, 2.3989999294281006, 2.364000082015991, 2.3420000076293945, 2.3410000801086426, 2.3269999027252197, 2.2909998893737793, 2.2890000343322754, 2.2720000743865967, 2.2780001163482666, 2.2330000400543213, 2.2230000495910645, 2.2249999046325684, 2.2109999656677246, 2.190000057220459, 2.178999900817871, 2.184000015258789, 2.1600000858306885, 2.1570000648498535, 2.1510000228881836, 2.128000020980835, 2.13700008392334, 2.13700008392334, 2.125, 2.1089999675750732, 2.1040000915527344, 2.1059999465942383, 2.109999895095825, 2.0920000076293945, 2.1089999675750732, 0.8460000157356262, 0.699999988079071, 0.6930000185966492, 2.1070001125335693, 2.111999988555908, 2.1080000400543213, 2.1080000400543213, 2.115000009536743, 2.1040000915527344, 2.117000102996826, 2.124000072479248, 2.1110000610351562, 2.134000062942505, 2.138000011444092, 2.1470000743865967, 2.1489999294281006, 1.2070000171661377, 2.177000045776367, 2.1610000133514404, 2.184000015258789, 2.186000108718872, 2.2100000381469727, 2.2290000915527344, 2.2200000286102295, 2.23799991607666, 2.2760000228881836, 0.7570000290870667, 0.7570000290870667, 0.0, 2.3310000896453857, 2.3440001010894775, 2.359999895095825, 2.3959999084472656, 2.3949999809265137, 2.4260001182556152, 2.443000078201294, 2.4709999561309814, 2.507999897003174, 2.5220000743865967, 2.568000078201294, 2.617000102996826, 2.6510000228881836, 2.674999952316284, 2.760999917984009, 2.5920000076293945, 2.828000068664551, 2.868000030517578, 2.9010000228881836, 2.381999969482422, 3.006999969482422, 3.058000087738037, 3.132999897003174, 3.180000066757202, 3.1659998893737793, 3.299999952316284, 1.7669999599456787, 1.9170000553131104, 3.5510001182556152, 3.621999979019165, 3.7899999618530273, 3.3970000743865967, 2.427999973297119, 3.316999912261963, 2.1630001068115234, 4.146999835968018, 4.170000076293945, 4.0929999351501465, 2.806999921798706, 2.7090001106262207, 1.5520000457763672, 4.031000137329102, 4.083000183105469, 4.014999866485596, 3.890000104904175, 0.0, 3.3340001106262207, 3.7219998836517334, 1.690999984741211, 3.7200000286102295, 3.322999954223633, 3.7190001010894775, 2.2899999618530273, 2.3399999141693115, 3.311000108718872, 2.9700000286102295, 3.6659998893737793, 3.614000082015991, 3.6480000019073486, 2.6579999923706055, 3.6029999256134033, 3.6419999599456787, 3.496999979019165, 3.6549999713897705]
    ranges = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.996999979019165, 0.0, 3.180000066757202, 2.2019999027252197, 0.0, 4.026000022888184, 4.133999824523926, 4.072000026702881, 4.168000221252441, 1.7680000066757202, 4.043000221252441, 0.0, 3.990999937057495, 3.9739999771118164, 1.065000057220459, 1.0809999704360962, 1.0609999895095825, 1.0779999494552612, 1.0490000247955322, 1.1019999980926514, 3.299999952316284, 3.2149999141693115, 0.9070000052452087, 0.9070000052452087, 0.8840000033378601, 0.8840000033378601, 0.8740000128746033, 0.8759999871253967, 0.8769999742507935, 0.9520000219345093, 0.8799999952316284, 1.680999994277954, 1.6549999713897705, 1.6829999685287476, 2.4839999675750732, 2.5429999828338623, 2.497999906539917, 2.4779999256134033, 2.4509999752044678, 2.4539999961853027, 2.4089999198913574, 2.3970000743865967, 2.36299991607666, 2.3410000801086426, 2.3380000591278076, 2.306999921798706, 2.2839999198913574, 2.2279999256134033, 2.25600004196167, 2.249000072479248, 2.2290000915527344, 0.0, 2.187999963760376, 0.0, 1.4170000553131104, 2.171999931335449, 2.1649999618530273, 2.1480000019073486, 2.1470000743865967, 2.1419999599456787, 2.071000099182129, 2.135999917984009, 2.1080000400543213, 2.119999885559082, 2.130000114440918, 2.109999895095825, 2.109999895095825, 2.0899999141693115, 2.0950000286102295, 2.0929999351501465, 2.0889999866485596, 2.1040000915527344, 2.0980000495910645, 2.0999999046325684, 2.0969998836517334, 2.0999999046325684, 2.1089999675750732, 2.1089999675750732, 2.0989999771118164, 2.124000072479248, 2.125999927520752, 2.140000104904175, 2.007999897003174, 2.1489999294281006, 1.1619999408721924, 0.0, 0.0, 0.0, 1.100000023841858, 0.0, 0.0, 1.1050000190734863, 1.0829999446868896, 1.0240000486373901, 1.0789999961853027, 1.0479999780654907, 0.0, 2.302000045776367, 2.3310000896453857, 1.9220000505447388, 0.0, 2.384000062942505, 2.4170000553131104, 2.4509999752044678, 2.4549999237060547, 2.4769999980926514, 2.509999990463257, 2.5490000247955322, 2.568000078201294, 1.1059999465942383, 0.0, 2.75, 2.7219998836517334, 2.5439999103546143, 2.86899995803833, 2.8940000534057617, 2.947999954223633, 3.065000057220459, 3.0350000858306885, 3.1019999980926514, 3.1470000743865967, 3.23799991607666, 1.4730000495910645, 3.3469998836517334, 2.125999927520752, 3.4579999446868896, 3.621999979019165, 3.5290000438690186, 3.5989999771118164, 0.0, 0.0, 0.29600000381469727, 0.2930000126361847, 0.29100000858306885, 0.28999999165534973, 0.28999999165534973, 0.29100000858306885, 0.2919999957084656, 0.2939999997615814, 0.31299999356269836, 0.0, 0.0, 0.0, 0.0, 0.0, 3.046999931335449, 3.0439999103546143, 3.0399999618530273, 2.997999906539917, 2.992000102996826, 2.9609999656677246, 2.986999988555908, 2.9639999866485596, 2.9830000400543213, 2.9619998931884766, 3.0, 2.946000099182129, 2.875999927520752, 2.927000045776367, 2.9240000247955322, 2.943000078201294, 2.9230000972747803, 2.936000108718872, 2.819000005722046, 2.9260001182556152, 2.938999891281128, 2.936000108718872, 2.930000066757202, 2.9619998931884766, 2.9769999980926514, 2.947000026702881, 2.9509999752044678, 3.002000093460083, 2.990000009536743, 2.986999988555908, 3.0199999809265137, 3.0409998893737793, 3.058000087738037, 3.0880000591278076, 3.072999954223633, 2.984999895095825, 1.965000033378601, 3.13700008392334, 3.174999952316284, 3.2130000591278076, 3.197000026702881, 3.2669999599456787, 3.2869999408721924, 3.246999979019165, 3.384999990463257, 3.3369998931884766, 3.2660000324249268, 3.180999994277954, 2.5320000648498535, 2.634000062942505, 1.8980000019073486, 2.9839999675750732, 2.8910000324249268, 2.884999990463257, 2.7950000762939453, 2.756999969482422, 2.7170000076293945, 2.6740000247955322, 2.5339999198913574, 2.5, 2.4779999256134033, 2.428999900817871, 2.4059998989105225, 2.375, 2.309999942779541, 2.2899999618530273, 2.2699999809265137, 2.2219998836517334, 2.197999954223633, 2.1740000247955322, 2.1449999809265137, 2.1080000400543213, 2.0959999561309814, 2.071000099182129, 2.062000036239624, 2.0450000762939453, 2.007999897003174, 1.9950000047683716, 1.9800000190734863, 1.9570000171661377, 1.9479999542236328, 1.9479999542236328, 1.9249999523162842, 1.899999976158142, 1.8940000534057617, 1.8760000467300415, 1.8550000190734863, 1.8380000591278076, 1.8389999866485596, 1.8109999895095825, 1.8049999475479126, 1.809000015258789, 1.7879999876022339, 1.784999966621399, 1.7769999504089355, 1.7569999694824219, 1.7699999809265137, 1.7669999599456787, 1.7519999742507935, 1.7450000047683716, 1.7430000305175781, 1.7369999885559082, 1.746999979019165, 1.715000033378601, 1.725000023841858, 1.7480000257492065, 1.7359999418258667, 1.7350000143051147, 1.7319999933242798, 1.7359999418258667, 1.746999979019165, 1.753999948501587, 1.7410000562667847, 1.7680000066757202, 1.7410000562667847, 1.7740000486373901, 1.774999976158142, 1.7760000228881836, 1.7799999713897705, 1.7699999809265137, 1.7920000553131104, 1.784999966621399, 1.7999999523162842, 1.8240000009536743, 1.8420000076293945, 1.8380000591278076, 1.8589999675750732, 1.8630000352859497, 1.8860000371932983, 1.8899999856948853, 1.9199999570846558, 1.9190000295639038, 1.9490000009536743, 1.9759999513626099, 1.972000002861023, 1.9800000190734863, 2.01200008392334, 2.0409998893737793, 2.0220000743865967, 2.078000068664551, 2.0950000286102295, 2.134000062942505, 2.115000009536743, 2.1679999828338623, 2.193000078201294, 2.2170000076293945, 2.1989998817443848, 2.253999948501587, 1.5420000553131104, 2.3429999351501465, 2.36899995803833, 2.390000104904175, 2.1080000400543213, 2.494999885559082, 2.3980000019073486, 2.615999937057495, 1.6740000247955322, 1.3899999856948853, 2.7820000648498535, 2.8369998931884766, 2.878000020980835, 2.9489998817443848, 2.875, 2.759000062942505, 3.190000057220459, 1.9639999866485596, 3.3340001106262207, 3.4130001068115234, 3.6589999198913574, 3.3510000705718994, 1.4670000076293945, 3.7679998874664307, 3.927999973297119, 3.9830000400543213, 3.690999984741211, 3.6389999389648438, 3.8550000190734863, 2.5840001106262207, 3.755000114440918, 3.7990000247955322, 3.7660000324249268, 3.756999969482422, 3.759000062942505, 3.7049999237060547, 3.63700008392334, 3.0969998836517334, 3.4170000553131104, 3.5269999504089355, 3.555999994277954, 3.256999969482422, 3.0309998989105225, 3.575000047683716, 3.502000093460083, 1.4919999837875366, 2.2219998836517334, 2.3910000324249268, 3.4769999980926514, 3.5250000953674316, 3.48799991607666, 3.5329999923706055, 3.4860000610351562, 3.50600004196167, 3.552999973297119, 3.5369999408721924, 3.5329999923706055, 3.4779999256134033, 2.5739998817443848, 0.0]
    #print(edit_theta(0, ranges)/math.pi*180)
    #print(edit_theta(-10.0/180.0*math.pi, ranges))
    print(edit_theta(0, ranges))
    print(edit_theta(-10.0/180.0*math.pi, ranges))